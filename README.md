# æƒ…æŠ¥æ™ºæ¢ç³»ç»Ÿ (Intel Aggregation System)

**AI é©±åŠ¨çš„å®æ—¶æƒ…æŠ¥é‡‡é›†ä¸åˆ†æå¹³å°**

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„ç°ä»£åŒ–æƒ…æŠ¥ç³»ç»Ÿï¼Œèƒ½å¤Ÿè‡ªåŠ¨ä»å¤–éƒ¨æ•°æ®æºï¼ˆPayload CMSï¼‰é‡‡é›†æƒ…æŠ¥ï¼Œåˆ©ç”¨ LLMï¼ˆLarge Language Modelï¼‰è¿›è¡Œæ™ºèƒ½æç‚¼ï¼ˆå»å™ªã€ç¿»è¯‘ã€æ‘˜è¦ã€æ‰“æ ‡ï¼‰ï¼Œå¹¶é€šè¿‡å®æ—¶é€šé“ï¼ˆSSEï¼‰æ¨é€ç»™å‰ç«¯å¤§å±å±•ç¤ºã€‚

---

## ğŸš€ ç³»ç»Ÿæ¦‚è¿° (System Overview)

æœ¬ç³»ç»Ÿæ—¨åœ¨è§£å†³æµ·é‡åŸå§‹æƒ…æŠ¥çš„**å®æ—¶è·å–**ä¸**é«˜æ•ˆå¤„ç†**é—®é¢˜ã€‚
æ ¸å¿ƒå·¥ä½œæµï¼š
1.  **é‡‡é›† (Ingestion)**: è‡ªåŠ¨è½®è¯¢å¤–éƒ¨ CMS ç³»ç»Ÿï¼Œè·å–åŸå§‹æƒ…æŠ¥æ•°æ®ã€‚
2.  **æç‚¼ (Refinement)**: åˆ©ç”¨ **Aliyun Qwen-Max** æ¨¡å‹å¯¹åŸå§‹æ–‡æœ¬è¿›è¡Œæ·±åº¦æ¸…æ´—ã€ä¸­æ–‡åŒ–ç¿»è¯‘ã€æ‘˜è¦é‡å†™åŠæ™ºèƒ½æ‰“æ ‡ã€‚
3.  **åˆ†å‘ (Distribution)**: é€šè¿‡ Server-Sent Events (SSE) æŠ€æœ¯ï¼Œå°†å¤„ç†åçš„é«˜ä»·å€¼æƒ…æŠ¥æ¯«ç§’çº§æ¨é€åˆ°å‰ç«¯ç•Œé¢ã€‚

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ (Tech Stack)

### åç«¯ (Backend)
*   **Framework**: FastAPI (Python) - é«˜æ€§èƒ½å¼‚æ­¥ Web æ¡†æ¶ã€‚
*   **AI Framework**: AgentScope (Multi-Agent Orchestration) - å¤šæ™ºèƒ½ä½“ååŒæ¡†æ¶ã€‚
*   **LLM Provider**: DashScope (Aliyun Qwen-Max) - æä¾›é¡¶çº§ä¸­æ–‡å¤„ç†èƒ½åŠ›ã€‚
*   **Database**: PostgreSQL - å­˜å‚¨ç»“æ„åŒ–æƒ…æŠ¥æ•°æ® (JSONB Tags)ã€‚
*   **Concurrency**: Asyncio + Aiohttp - é«˜å¹¶å‘ç½‘ç»œè¯·æ±‚å¤„ç†ã€‚
*   **Real-time**: Server-Sent Events (SSE) - å•å‘å®æ—¶æ•°æ®æµã€‚

### å‰ç«¯ (Frontend)
*   **Framework**: React 18 + Vite - ç°ä»£ UI å¼€å‘ä½“éªŒã€‚
*   **Styling**: Tailwind CSS - åŸå­åŒ–æ ·å¼è®¾è®¡ã€‚
*   **Language**: TypeScript - ç±»å‹å®‰å…¨ä¿éšœã€‚
*   **State Management**: React Hooks (Custom SSE Hooks) - å®æ—¶æµçŠ¶æ€åŒæ­¥ã€‚

---

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„ (Architecture)

### 1. æ•°æ®é‡‡é›†å±‚ (Ingestion Layer)
*   **å…¨è‡ªåŠ¨æ•°æ®å¼•æ“ (`payload_poller.py`)**:
    *   æ¨¡æ‹Ÿç”¨æˆ·ç™»å½• Payload CMS è·å– JWT Tokenã€‚
    *   æ‰§è¡Œâ€œè½®è¯¢ -> å»é‡ -> è§¦å‘ AI -> å…¥åº“ -> å¹¿æ’­â€çš„å®Œæ•´æµæ°´çº¿ã€‚

### 2. æ™ºèƒ½å¤„ç†å±‚ (Processing Layer)
*   **AI æ™ºèƒ½ä½“ (`agents.py`)**:
    *   **RefinementAgent**: æƒ…æŠ¥åˆ†æä¸“å®¶ã€‚è´Ÿè´£å»å™ªã€ç¿»è¯‘ã€æ‘˜è¦åŠæ™ºèƒ½æ‰“æ ‡ï¼ˆå›½å®¶/é¢†åŸŸè‡ªåŠ¨ç€è‰²ï¼‰ã€‚
    *   **Mock Fallback**: å…·å¤‡é«˜å®¹é”™æœºåˆ¶ï¼Œå½“ LLM æœåŠ¡ä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§ï¼Œç¡®ä¿ä¸šåŠ¡ä¸ä¸­æ–­ã€‚
*   **è°ƒåº¦å™¨ (`orchestrator.py`)**: ç®¡ç† Agent ç”Ÿå‘½å‘¨æœŸåŠä»»åŠ¡åˆ†å‘ã€‚

### 3. å­˜å‚¨ä¸æ¥å£å±‚ (Data & API Layer)
*   **PostgreSQL**: ä½¿ç”¨ JSONB æ ¼å¼çµæ´»å­˜å‚¨æ ‡ç­¾æ•°æ®ã€‚
*   **RESTful API**: æä¾›å†å²æ•°æ®æŸ¥è¯¢ (`/intel`)ã€è¯¦æƒ…è·å–ã€æ”¶è—/å–æ¶ˆæ”¶è—ç­‰åŠŸèƒ½ã€‚
*   **SSE Channel**: `/events` æ¥å£ç»´æŒé•¿è¿æ¥ï¼Œå®æ—¶æ¨é€æœ€æ–°æƒ…æŠ¥ã€‚

### 4. å‰ç«¯å±•ç¤ºå±‚ (Presentation Layer)
*   **å®æ—¶åŒæ­¥ (`useGlobalIntel.ts`)**: è‡ªåŠ¨ç›‘å¬åç«¯äº‹ä»¶æµï¼Œæ— åˆ·æ–°æ›´æ–° UIã€‚
*   **åŠ¨æ€äº¤äº’**: æ”¯æŒæ”¶è—ã€å¯¼å‡ºã€æŒ‰æ—¶é—´ç­›é€‰ã€å…³é”®è¯æœç´¢ã€‚
*   **å¯è§†åŒ–æ ‡ç­¾**: æ ¹æ® AI åˆ†æç»“æœï¼Œè‡ªåŠ¨æ¸²æŸ“çº¢è‰²ï¼ˆé‡ç‚¹å›½å®¶ï¼‰ã€è“è‰²ï¼ˆé¢†åŸŸï¼‰ç­‰å½©è‰²æ ‡ç­¾ã€‚

---

## ğŸ“¦ å¿«é€Ÿå¼€å§‹ (Getting Started)

### 1. ç¯å¢ƒå‡†å¤‡
*   **Python**: 3.8+
*   **Node.js**: 16+
*   **PostgreSQL**: ç¡®ä¿æ•°æ®åº“æœåŠ¡å·²å¯åŠ¨ã€‚

### 2. å¯åŠ¨åç«¯
```bash
cd backend

# åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ (å¯é€‰)
python -m venv .venv
source .venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡ (.env)
# ç¡®ä¿é…ç½®äº† DASHSCOPE_API_KEY, POSTGRES_URL, CMS_URL ç­‰

# å¯åŠ¨æœåŠ¡
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 3. å¯åŠ¨å‰ç«¯
```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```
å‰ç«¯è®¿é—®åœ°å€: `http://localhost:5173`

---

## ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯• (Testing)

é¡¹ç›®åŒ…å«å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼Œç”¨äºéªŒè¯æ ¸å¿ƒé€»è¾‘ï¼š

| æµ‹è¯•è„šæœ¬ | æè¿° |
| :--- | :--- |
| `backend/tests/test_real_api_ingestion.py` | **å…¨é“¾è·¯é›†æˆæµ‹è¯•**ã€‚éªŒè¯ CMS æŠ“å– -> AI å¤„ç† -> DB å­˜å‚¨ -> API æŸ¥è¯¢çš„å…¨è¿‡ç¨‹ã€‚ |
| `backend/tests/test_agent_tags_generation.py` | **AI è§£ææµ‹è¯•**ã€‚éªŒè¯ LLM è¿”å› JSON çš„è§£æå¥å£®æ€§ï¼ˆåŒ…æ‹¬ Markdown æ¸…æ´—ï¼‰ã€‚ |
| `backend/tests/test_favorites_standalone.py` | **æ”¶è—åŠŸèƒ½æµ‹è¯•**ã€‚ç‹¬ç«‹éªŒè¯æ”¶è—/å–æ¶ˆæ”¶è—çš„åç«¯çŠ¶æ€æµè½¬ã€‚ |

è¿è¡Œæµ‹è¯•ç¤ºä¾‹ï¼š
```bash
python backend/tests/test_favorites_standalone.py
```

---

## ğŸ“‚ é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```
system_mvp/
â”œâ”€â”€ backend/                # FastAPI åç«¯
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ agent/          # AgentScope æ™ºèƒ½ä½“ä¸ç¼–æ’
â”‚   â”‚   â”œâ”€â”€ services/       # çˆ¬è™«ä¸è½®è¯¢æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ routes/         # API è·¯ç”±å®šä¹‰
â”‚   â”‚   â””â”€â”€ db_models.py    # æ•°æ®åº“æ¨¡å‹
â”‚   â””â”€â”€ tests/              # æµ‹è¯•è„šæœ¬é›†
â”œâ”€â”€ frontend/               # React å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/     # UI ç»„ä»¶ (IntelList, IntelItem)
â”‚   â”‚   â”œâ”€â”€ hooks/          # é€»è¾‘å¤ç”¨ (useGlobalIntel)
â”‚   â”‚   â””â”€â”€ pages/          # é¡µé¢è§†å›¾
â””â”€â”€ PROJECT_REVIEW.md       # è¯¦ç»†çš„æŠ€æœ¯å¤ç›˜æ–‡æ¡£
```
